<!DOCTYPE html>
<html>

<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏≠‡∏°</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Sarabun', 'Prompt', sans-serif;
    }

    .hidden {
      display: none !important;
    }

    /* Loading Spinner */
    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(99, 102, 241, 0.3);
      border-radius: 50%;
      border-top-color: rgb(99, 102, 241);
      animation: spin 0.8s linear infinite;
    }

    .loading-overlay {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(2px);
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .fade-in {
      animation: fadeIn 0.3s ease-out;
    }

    /* Pulse animation for loading state */
    @keyframes pulse {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.5;
      }
    }

    .pulse {
      animation: pulse 1.5s ease-in-out infinite;
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
      .max-w-7xl {
        padding-left: 1rem;
        padding-right: 1rem;
      }

      nav .flex {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      nav button {
        white-space: nowrap;
        font-size: 0.875rem;
        padding: 0.75rem 1rem;
      }

      .grid-cols-2 {
        grid-template-columns: 1fr;
      }

      .grid-cols-3 {
        grid-template-columns: 1fr;
      }

      h1 {
        font-size: 1.25rem !important;
      }

      h2 {
        font-size: 1.5rem !important;
      }

      .text-2xl {
        font-size: 1.25rem !important;
      }

      table {
        font-size: 0.75rem;
      }

      .px-6 {
        padding-left: 0.75rem !important;
        padding-right: 0.75rem !important;
      }

      .grid.grid-cols-12 {
        grid-template-columns: 1fr;
      }

      .grid.grid-cols-12>div {
        grid-column: span 12;
      }
    }

    @media (max-width: 640px) {
      header .flex {
        flex-direction: column;
        gap: 0.5rem;
        align-items: flex-start;
      }

      #user-email {
        order: -1;
      }
    }
  </style>
</head>

<body class="bg-gray-50" onload="loadConfig()">

  <!-- Header -->
  <header class="bg-white shadow-sm border-b">
    <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
      <h1 class="text-2xl font-bold text-indigo-600" id="app-title">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏≠‡∏°</h1>
      <div class="flex items-center gap-4">
        <!-- Language Selector -->
        <select id="header-language" onchange="changeLanguage(this.value)"
          class="px-3 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-indigo-600">
          <option value="th">üáπüá≠ ‡πÑ‡∏ó‡∏¢</option>
          <option value="en">üá¨üáß English</option>
        </select>
        <span id="user-email" class="text-sm text-gray-600"></span>
        <button onclick="logout()" class="text-red-600 hover:text-red-700 text-sm" id="logout-btn">
          ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
        </button>
      </div>
    </div>
  </header>

  <!-- Navigation -->
  <nav class="bg-white border-b">
    <div class="max-w-7xl mx-auto px-4">
      <div class="flex gap-6">
        <button onclick="showPage('history')" id="nav-history"
          class="py-3 px-4 border-b-2 border-indigo-600 text-indigo-600">
          <span class="nav-text" data-th="‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á" data-en="History">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</span>
        </button>
        <button onclick="showPage('booking')" id="nav-booking"
          class="py-3 px-4 border-b-2 border-transparent text-gray-600 hover:text-gray-800">
          <span class="nav-text" data-th="‡∏à‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà" data-en="New Booking">‡∏à‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</span>
        </button>
        <button onclick="showPage('schedule')" id="nav-schedule"
          class="py-3 px-4 border-b-2 border-transparent text-gray-600 hover:text-gray-800">
          <span class="nav-text" data-th="‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á" data-en="Schedule">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</span>
        </button>
        <button onclick="showPage('profile')" id="nav-profile"
          class="py-3 px-4 border-b-2 border-transparent text-gray-600 hover:text-gray-800">
          <span class="nav-text" data-th="‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå" data-en="Profile">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</span>
        </button>
        <button onclick="showPage('config')" id="nav-config"
          class="py-3 px-4 border-b-2 border-transparent text-gray-600 hover:text-gray-800">
          <span class="nav-text" data-th="‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤" data-en="Settings">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</span>
        </button>
      </div>
    </div>
  </nav>

  <main class="max-w-7xl mx-auto px-4 py-8">
    <!-- History Page -->
    <div id="page-history" class="page-content">
      <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
        <h2 class="text-2xl font-bold text-gray-800" data-th="‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á" data-en="Booking History">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
        </h2>
        <div class="flex flex-wrap gap-2">
          <button onclick="filterBookings('all')" id="filter-all"
            class="px-4 py-2 rounded-lg text-sm bg-indigo-600 text-white">
            <span data-th="‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î" data-en="All">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
          </button>
          <button onclick="filterBookings('upcoming')" id="filter-upcoming"
            class="px-4 py-2 rounded-lg text-sm bg-white text-gray-700 border">
            <span data-th="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏∞‡∏ñ‡∏∂‡∏á" data-en="Upcoming">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏∞‡∏ñ‡∏∂‡∏á</span>
          </button>
          <button onclick="filterBookings('byDate')" id="filter-byDate"
            class="px-4 py-2 rounded-lg text-sm bg-white text-gray-700 border">
            <span data-th="‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô" data-en="By Date">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô</span>
          </button>
        </div>
      </div>
      <div id="bookings-list" class="space-y-4">
        <div class="bg-white rounded-lg shadow p-8 text-center">
          <p class="text-gray-500" data-th="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•..." data-en="Loading...">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
        </div>
      </div>
    </div>

    <!-- Booking Page -->
    <div id="page-booking" class="page-content hidden">
      <div class="max-w-3xl mx-auto">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏≠‡∏°</h2>

        <!-- Step Indicator -->
        <div class="flex items-center justify-between mb-8">
          <div class="flex items-center">
            <div id="step-1-indicator"
              class="w-10 h-10 rounded-full flex items-center justify-center font-bold bg-indigo-600 text-white">1</div>
            <div id="step-1-line" class="w-24 h-1 bg-gray-200"></div>
          </div>
          <div class="flex items-center">
            <div id="step-2-indicator"
              class="w-10 h-10 rounded-full flex items-center justify-center font-bold bg-gray-200 text-gray-500">2
            </div>
            <div id="step-2-line" class="w-24 h-1 bg-gray-200"></div>
          </div>
          <div class="w-10 h-10 rounded-full flex items-center justify-center font-bold bg-gray-200 text-gray-500"
            id="step-3-indicator">3</div>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-8">
          <!-- Step 1: Select OS and Usage -->
          <div id="step-1" class="booking-step">
            <div class="space-y-6">
              <div>
                <label class="block text-lg font-semibold text-gray-700 mb-3">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£</label>
                <div class="grid grid-cols-2 gap-4">
                  <button onclick="selectOS('Mac')" id="os-mac"
                    class="p-4 border-2 border-gray-200 rounded-lg hover:border-gray-300">
                    <p class="font-medium">Mac</p>
                  </button>
                  <button onclick="selectOS('Windows')" id="os-windows"
                    class="p-4 border-2 border-gray-200 rounded-lg hover:border-gray-300">
                    <p class="font-medium">Windows</p>
                  </button>
                </div>
              </div>

              <div>
                <label class="block text-lg font-semibold text-gray-700 mb-3">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
                  (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</label>
                <div class="grid grid-cols-2 gap-3" id="usage-options">
                  <!-- ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢ JavaScript -->
                </div>
              </div>

              <button onclick="goToStep(2)" id="step1-next" disabled
                class="w-full bg-gray-300 text-white py-3 rounded-lg font-medium cursor-not-allowed">
                ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
              </button>
            </div>
          </div>

          <!-- Step 2: Select Date, Time, Room, Computer -->
          <div id="step-2" class="booking-step hidden">
            <div class="space-y-6">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                <input type="date" id="booking-date" onchange="updateRoomList()"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-600 focus:border-transparent">
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤</label>
                <div class="grid grid-cols-3 gap-3">
                  <button onclick="selectTime('‡πÄ‡∏ä‡πâ‡∏≤')" id="time-morning"
                    class="p-3 border-2 border-gray-200 rounded-lg">‡πÄ‡∏ä‡πâ‡∏≤</button>
                  <button onclick="selectTime('‡∏ö‡πà‡∏≤‡∏¢')" id="time-afternoon"
                    class="p-3 border-2 border-gray-200 rounded-lg">‡∏ö‡πà‡∏≤‡∏¢</button>
                  <button onclick="selectTime('‡∏ó‡∏±‡πâ‡∏á‡∏ß‡∏±‡∏ô')" id="time-allday"
                    class="p-3 border-2 border-gray-200 rounded-lg">‡∏ó‡∏±‡πâ‡∏á‡∏ß‡∏±‡∏ô</button>
                </div>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</label>

                <!-- Loading State -->
                <div id="rooms-loading" class="hidden">
                  <div class="flex items-center justify-center py-12 space-x-3">
                    <div class="loading-spinner"></div>
                    <span class="text-gray-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡πâ‡∏≠‡∏á...</span>
                  </div>
                </div>

                <!-- Rooms List -->
                <div id="rooms-list" class="space-y-3">
                  <!-- ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢ JavaScript -->
                </div>
              </div>

              <div class="flex gap-3">
                <button onclick="goToStep(1)"
                  class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg hover:bg-gray-300">
                  ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö
                </button>
                <button onclick="goToStep(3)" id="step2-next" disabled
                  class="flex-1 bg-gray-300 text-white py-3 rounded-lg cursor-not-allowed">
                  ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
                </button>
              </div>
            </div>
          </div>

          <!-- Step 3: Fill Booking Form -->
          <div id="step-3" class="booking-step hidden">
            <div class="space-y-4">
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠</label>
                  <input type="text" id="form-firstname"
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-600 focus:border-transparent">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                  <input type="text" id="form-lastname"
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-600 focus:border-transparent">
                </div>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                <input type="tel" id="form-phone"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-600 focus:border-transparent">
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</label>
                <input type="text" id="form-studentid"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-600 focus:border-transparent">
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                <input type="text" id="form-subject"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-600 focus:border-transparent">
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ</label>
                <textarea id="form-reason" rows="3"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-600 focus:border-transparent"></textarea>
              </div>

              <div class="flex items-start gap-3 p-4 bg-gray-50 rounded-lg">
                <input type="checkbox" id="form-consent" class="mt-1">
                <label for="form-consent" class="text-sm text-gray-700">
                  ‡∏Ç‡πâ‡∏≤‡∏û‡πÄ‡∏à‡πâ‡∏≤‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏ô‡∏≥‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢
                  ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£
                </label>
              </div>

              <div class="flex gap-3">
                <button onclick="goToStep(2)"
                  class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg hover:bg-gray-300">
                  ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö
                </button>
                <button onclick="submitBooking()" id="step3-submit"
                  class="flex-1 bg-indigo-600 text-white py-3 rounded-lg hover:bg-indigo-700">
                  ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Schedule Page -->
    <div id="page-schedule" class="page-content hidden">
      <h2 class="text-2xl font-bold text-gray-800 mb-6">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
      <div class="bg-white rounded-lg shadow p-6">
        <div class="flex gap-4 mb-6">
          <div class="flex-1">
            <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
            <input type="date" id="schedule-date" onchange="loadSchedule()"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-600 focus:border-transparent">
          </div>
          <div class="flex items-end">
            <button onclick="loadSchedule()"
              class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
              ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
            </button>
          </div>
        </div>

        <!-- Loading State -->
        <div id="schedule-loading" class="hidden">
          <div class="flex items-center justify-center py-12 space-x-3">
            <div class="loading-spinner"></div>
            <span class="text-gray-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á...</span>
          </div>
        </div>

        <!-- Schedule Table -->
        <div id="schedule-container" class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏´‡πâ‡∏≠‡∏á</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">OS</th>
                <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">‡πÄ‡∏ä‡πâ‡∏≤
                  (08:00-12:00)</th>
                <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏ö‡πà‡∏≤‡∏¢
                  (13:00-17:00)</th>
              </tr>
            </thead>
            <tbody id="schedule-tbody" class="bg-white divide-y divide-gray-200">
              <!-- ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢ JavaScript -->
            </tbody>
          </table>
        </div>

        <!-- Legend -->
        <div class="mt-6 flex flex-wrap gap-4 items-center justify-center text-sm">
          <div class="flex items-center gap-2">
            <div class="w-4 h-4 rounded bg-green-100 border border-green-300"></div>
            <span class="text-gray-600">‡∏ß‡πà‡∏≤‡∏á</span>
          </div>
          <div class="flex items-center gap-2">
            <div class="w-4 h-4 rounded bg-red-100 border border-red-300"></div>
            <span class="text-gray-600">‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß</span>
          </div>
          <div class="flex items-center gap-2">
            <div class="w-4 h-4 rounded bg-yellow-100 border border-yellow-300"></div>
            <span class="text-gray-600">‡∏à‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</span>
          </div>
        </div>

        <!-- Summary Stats -->
        <div id="schedule-stats" class="mt-6 grid grid-cols-3 gap-4">
          <!-- ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢ JavaScript -->
        </div>
      </div>
    </div>

    <!-- Profile Page -->
    <div id="page-profile" class="page-content hidden">
      <div class="max-w-2xl mx-auto">
        <h2 class="text-2xl font-bold text-gray-800 mb-6" data-th="‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô" data-en="My Profile">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô
        </h2>
        <div class="bg-white rounded-lg shadow-lg p-8">
          <div class="space-y-4">
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1" data-th="‡∏ä‡∏∑‡πà‡∏≠"
                  data-en="First Name">‡∏ä‡∏∑‡πà‡∏≠</label>
                <input type="text" id="profile-firstname"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-600 focus:border-transparent">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1" data-th="‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•"
                  data-en="Last Name">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                <input type="text" id="profile-lastname"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-600 focus:border-transparent">
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1" data-th="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå"
                data-en="Phone Number">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
              <input type="tel" id="profile-phone"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-600 focus:border-transparent">
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1" data-th="‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤"
                data-en="Student ID">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</label>
              <input type="text" id="profile-studentid"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-600 focus:border-transparent">
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1" data-th="‡∏†‡∏≤‡∏©‡∏≤" data-en="Language">‡∏†‡∏≤‡∏©‡∏≤</label>
              <select id="profile-language"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-600 focus:border-transparent">
                <option value="th">üáπüá≠ ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ (Thai)</option>
                <option value="en">üá¨üáß ‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© (English)</option>
              </select>
            </div>

            <button onclick="saveProfile()"
              class="w-full bg-indigo-600 text-white py-3 rounded-lg hover:bg-indigo-700 font-medium">
              <span data-th="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•" data-en="Save Profile">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
            </button>

            <p class="text-sm text-gray-500 text-center mt-4"
              data-th="‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ô‡∏≥‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á"
              data-en="Saved information will be automatically used when making bookings">
              ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ô‡∏≥‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Config Page -->
    <div id="page-config" class="page-content hidden">
      <div class="max-w-4xl mx-auto">
        <h2 class="text-2xl font-bold text-gray-800 mb-6" data-th="‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö" data-en="System Settings">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö
        </h2>

        <!-- Booking Period Settings -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
          <h3 class="text-lg font-semibold text-gray-800 mb-4" data-th="‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏à‡∏≠‡∏á" data-en="Booking Period">
            ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏à‡∏≠‡∏á</h3>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2" data-th="‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô"
                data-en="Start Date">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</label>
              <input type="date" id="config-start-date"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-600">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2" data-th="‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î"
                data-en="End Date">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label>
              <input type="date" id="config-end-date"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-600">
            </div>
          </div>
          <p class="text-sm text-gray-500 mt-2"
            data-th="‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏à‡∏≠‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î (‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏Å‡∏±‡∏î)"
            data-en="The system will only allow bookings within the specified date range (leave blank for no restriction)">
            ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏à‡∏≠‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î (‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏Å‡∏±‡∏î)
          </p>
        </div>

        <!-- Blocked Dates -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
          <h3 class="text-lg font-semibold text-gray-800 mb-4" data-th="‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á" data-en="Blocked Dates">
            ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</h3>

          <div class="mb-4 p-4 bg-gray-50 rounded-lg">
            <div class="space-y-3">
              <div class="grid grid-cols-1 md:grid-cols-3 gap-2">
                <div>
                  <label class="block text-xs text-gray-600 mb-1" data-th="‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà" data-en="Date">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                  <input type="date" id="blocked-date"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                </div>
                <div>
                  <label class="block text-xs text-gray-600 mb-1" data-th="‡∏´‡πâ‡∏≠‡∏á" data-en="Room">‡∏´‡πâ‡∏≠‡∏á</label>
                  <select id="blocked-room" onchange="updateBlockedComputers()"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á --</option>
                  </select>
                </div>
                <div>
                  <label class="block text-xs text-gray-600 mb-1" data-th="‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á" data-en="Computer">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</label>
                  <select id="blocked-computer" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á --</option>
                  </select>
                </div>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                <div>
                  <label class="block text-xs text-gray-600 mb-1" data-th="‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• (‡πÑ‡∏ó‡∏¢)" data-en="Reason (Thai)">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•
                    (‡πÑ‡∏ó‡∏¢)</label>
                  <input type="text" id="blocked-reason-th" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î, ‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                </div>
                <div>
                  <label class="block text-xs text-gray-600 mb-1" data-th="‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• (‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©)"
                    data-en="Reason (English)">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• (‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©)</label>
                  <input type="text" id="blocked-reason-en" placeholder="e.g. Holiday, Maintenance"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                </div>
              </div>
              <button onclick="addBlockedDate()"
                class="w-full md:w-auto px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm">
                <span data-th="+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ô‡∏õ‡∏¥‡∏î‡∏à‡∏≠‡∏á" data-en="+ Add Blocked Date">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ô‡∏õ‡∏¥‡∏î‡∏à‡∏≠‡∏á</span>
              </button>
            </div>
          </div>

          <div id="blocked-dates-list" class="space-y-2">
            <!-- Will be populated by JavaScript -->
          </div>
        </div>

        <!-- Email Settings -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
          <h3 class="text-lg font-semibold text-gray-800 mb-4" data-th="‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏µ‡πÄ‡∏°‡∏•" data-en="Email Settings">
            ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏µ‡πÄ‡∏°‡∏•</h3>

          <div class="space-y-4">
            <div class="flex items-center gap-3">
              <input type="checkbox" id="config-email-enabled" class="w-4 h-4">
              <label for="config-email-enabled" class="text-sm font-medium text-gray-700"
                data-th="‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô" data-en="Enable email notifications">
                ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
              </label>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                data-th="‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö (‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏™‡∏≥‡πÄ‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á)" data-en="Admin Email (will receive booking copies)">
                ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö (‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏™‡∏≥‡πÄ‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á)
              </label>
              <input type="email" id="config-admin-email"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-600">
            </div>
          </div>
        </div>

        <!-- Save Button -->
        <div class="flex gap-3">
          <button onclick="saveConfig()"
            class="flex-1 bg-indigo-600 text-white py-3 rounded-lg hover:bg-indigo-700 font-medium">
            <span data-th="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤" data-en="Save Settings">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</span>
          </button>
          <button onclick="loadConfig()"
            class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-medium">
            <span data-th="‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä" data-en="Refresh">‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</span>
          </button>
        </div>
      </div>
    </div>
  </main>

  <script>
    // Global variables
    let currentUser = null;
    let allRooms = [];
    let allBookings = [];
    let currentBookingsForDate = []; // ‡πÄ‡∏Å‡πá‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    let currentFilter = 'all';
    let userProfile = null;
    let systemConfig = {};
    let blockedDates = [];
    let currentLanguage = 'th';

    // Booking form state
    let selectedOS = '';
    let selectedUsage = [];
    let selectedDate = '';
    let selectedTime = '';
    let selectedRoom = '';
    let selectedComputer = '';

    const usageOptions = ['Editor', 'Color', '3D', 'Visual effect', 'Graphic', 'Sound'];

    // Initialize
    window.onload = function () {
      loadCurrentUser();
      loadRooms();
      loadUserProfile();
      loadUserBookings();
      loadConfig();
      loadBlockedDates();
      initializeUsageOptions();
      setMinDate();
    };

    function loadCurrentUser() {
      google.script.run.withSuccessHandler(function (user) {
        currentUser = user;
        document.getElementById('user-email').textContent = user.email;
      }).getCurrentUser();
    }

    function loadRooms() {
      google.script.run.withSuccessHandler(function (rooms) {
        allRooms = rooms;
        renderRoomsList();
        loadSchedule();
        updateBlockedRoomOptions();
      }).getRooms();
    }

    function updateBlockedRoomOptions() {
      const select = document.getElementById('blocked-room');
      select.innerHTML = '<option value="">-- ' + (currentLanguage === 'th' ? '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á' : 'Select Room') + ' --</option>';

      allRooms.forEach(room => {
        const option = document.createElement('option');
        option.value = room.id;
        option.textContent = room.name;
        select.appendChild(option);
      });
    }

    function updateBlockedComputers() {
      const roomId = document.getElementById('blocked-room').value;
      const select = document.getElementById('blocked-computer');
      select.innerHTML = '<option value="">-- ' + (currentLanguage === 'th' ? '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á' : 'Select Computer') + ' --</option>';

      if (!roomId) return;

      const room = allRooms.find(r => r.id === roomId);
      if (!room) return;

      room.computers.forEach(computer => {
        const option = document.createElement('option');
        option.value = computer.id;
        option.textContent = computer.id + ' (' + computer.os + ')';
        select.appendChild(option);
      });
    }

    function loadUserProfile() {
      google.script.run.withSuccessHandler(function (profile) {
        if (profile) {
          userProfile = profile;
          document.getElementById('profile-firstname').value = profile.firstName || '';
          document.getElementById('profile-lastname').value = profile.lastName || '';
          document.getElementById('profile-phone').value = profile.phone || '';
          document.getElementById('profile-studentid').value = profile.studentId || '';
          document.getElementById('profile-language').value = profile.language || 'th';

          // Set language
          currentLanguage = profile.language || 'th';
          document.getElementById('header-language').value = currentLanguage;
          updateLanguage();
        }
      }).getUserProfile();
    }

    // Language functions
    function changeLanguage(lang) {
      currentLanguage = lang;
      updateLanguage();
    }

    function updateLanguage() {
      document.querySelectorAll('[data-th]').forEach(el => {
        const text = currentLanguage === 'th' ? el.getAttribute('data-th') : el.getAttribute('data-en');
        if (text) {
          if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
            el.placeholder = text;
          } else {
            el.textContent = text;
          }
        }
      });

      // Update page title
      if (currentLanguage === 'en') {
        document.getElementById('app-title').textContent = 'Room & Computer Booking System';
      } else {
        document.getElementById('app-title').textContent = '‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏≠‡∏°';
      }
    }

    function loadUserBookings() {
      google.script.run
        .withSuccessHandler(function (bookings) {
          console.log('Loaded bookings:', bookings);
          allBookings = bookings;
          renderBookings();
        })
        .withFailureHandler(function (error) {
          console.error('Error loading bookings:', error);
          alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ' + error.message);
        })
        .getUserBookings();
    }

    function initializeUsageOptions() {
      const container = document.getElementById('usage-options');
      container.innerHTML = usageOptions.map(usage => `
        <button onclick="toggleUsage('${usage}')" id="usage-${usage.replace(/\s/g, '-')}" 
                class="p-3 border-2 border-gray-200 rounded-lg hover:border-gray-300 text-sm">
          ${usage}
        </button>
      `).join('');
    }

    function setMinDate() {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('booking-date').min = today;
      document.getElementById('schedule-date').value = today;
    }

    // Page navigation
    function showPage(pageName) {
      // Hide all pages
      document.querySelectorAll('.page-content').forEach(page => {
        page.classList.add('hidden');
      });

      // Remove active class from all nav buttons
      document.querySelectorAll('nav button').forEach(btn => {
        btn.className = 'py-3 px-4 border-b-2 border-transparent text-gray-600 hover:text-gray-800';
      });

      // Show selected page
      document.getElementById('page-' + pageName).classList.remove('hidden');
      document.getElementById('nav-' + pageName).className = 'py-3 px-4 border-b-2 border-indigo-600 text-indigo-600';

      // Reset booking form when going to booking page
      if (pageName === 'booking') {
        resetBookingForm();
      }

      // Load schedule when going to schedule page
      if (pageName === 'schedule') {
        loadScheduleBlockedDates();
        loadSchedule();
      }

      // Load config when going to config page
      if (pageName === 'config') {
        loadConfig();
        loadBlockedDates();
      }
    }

    function logout() {
      window.top.location.href = 'about:blank';
    }

    // Booking functions
    function selectOS(os) {
      selectedOS = os;
      document.getElementById('os-mac').className = 'p-4 border-2 border-gray-200 rounded-lg hover:border-gray-300';
      document.getElementById('os-windows').className = 'p-4 border-2 border-gray-200 rounded-lg hover:border-gray-300';
      document.getElementById('os-' + os.toLowerCase()).className = 'p-4 border-2 border-indigo-600 bg-indigo-50 rounded-lg';
      updateStep1Button();
    }

    function toggleUsage(usage) {
      const index = selectedUsage.indexOf(usage);
      const btn = document.getElementById('usage-' + usage.replace(/\s/g, '-'));

      if (index > -1) {
        selectedUsage.splice(index, 1);
        btn.className = 'p-3 border-2 border-gray-200 rounded-lg hover:border-gray-300 text-sm';
      } else {
        selectedUsage.push(usage);
        btn.className = 'p-3 border-2 border-indigo-600 bg-indigo-50 text-indigo-700 rounded-lg text-sm';
      }
    }

    function updateStep1Button() {
      const btn = document.getElementById('step1-next');
      if (selectedOS) {
        btn.disabled = false;
        btn.className = 'w-full bg-indigo-600 text-white py-3 rounded-lg hover:bg-indigo-700 font-medium';
      } else {
        btn.disabled = true;
        btn.className = 'w-full bg-gray-300 text-white py-3 rounded-lg font-medium cursor-not-allowed';
      }
    }

    function selectTime(time) {
      selectedTime = time;
      document.getElementById('time-morning').className = 'p-3 border-2 border-gray-200 rounded-lg';
      document.getElementById('time-afternoon').className = 'p-3 border-2 border-gray-200 rounded-lg';
      document.getElementById('time-allday').className = 'p-3 border-2 border-gray-200 rounded-lg';

      if (time === '‡πÄ‡∏ä‡πâ‡∏≤') document.getElementById('time-morning').className = 'p-3 border-2 border-indigo-600 bg-indigo-50 rounded-lg';
      if (time === '‡∏ö‡πà‡∏≤‡∏¢') document.getElementById('time-afternoon').className = 'p-3 border-2 border-indigo-600 bg-indigo-50 rounded-lg';
      if (time === '‡∏ó‡∏±‡πâ‡∏á‡∏ß‡∏±‡∏ô') document.getElementById('time-allday').className = 'p-3 border-2 border-indigo-600 bg-indigo-50 rounded-lg';

      // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô
      selectedRoom = '';
      selectedComputer = '';

      // ‡πÅ‡∏™‡∏î‡∏á loading animation
      const roomsList = document.getElementById('rooms-list');
      roomsList.classList.add('pulse');

      // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
      setTimeout(() => {
        renderRoomsList();
        roomsList.classList.remove('pulse');
        updateStep2Button();
      }, 300);
    }

    function updateRoomList() {
      selectedDate = document.getElementById('booking-date').value;

      if (!selectedDate) {
        renderRoomsList();
        updateStep2Button();
        return;
      }

      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
      if (systemConfig.bookingStartDate && selectedDate < systemConfig.bookingStartDate) {
        alert(currentLanguage === 'th' ?
          '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏à‡∏≠‡∏á‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà ' + formatDate(systemConfig.bookingStartDate) :
          'Booking not available for selected date. Please select from ' + formatDate(systemConfig.bookingStartDate));
        document.getElementById('booking-date').value = '';
        return;
      }

      if (systemConfig.bookingEndDate && selectedDate > systemConfig.bookingEndDate) {
        alert(currentLanguage === 'th' ?
          '‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡πà‡∏≠‡∏ô ' + formatDate(systemConfig.bookingEndDate) :
          'Booking closed for selected date. Please select before ' + formatDate(systemConfig.bookingEndDate));
        document.getElementById('booking-date').value = '';
        return;
      }

      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏õ‡∏¥‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
      if (isDateBlocked(selectedDate)) {
        const reason = getBlockedDateReason(selectedDate);
        alert((currentLanguage === 'th' ? '‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£: ' : 'This date is blocked: ') + reason);
        document.getElementById('booking-date').value = '';
        return;
      }

      // ‡πÅ‡∏™‡∏î‡∏á loading
      showRoomsLoading();

      // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
      google.script.run
        .withSuccessHandler(function (bookings) {
          console.log('Bookings for selected date:', bookings);
          currentBookingsForDate = bookings;

          // ‡∏ã‡πà‡∏≠‡∏ô loading ‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
          hideRoomsLoading();
          renderRoomsList();
          updateStep2Button();
        })
        .withFailureHandler(function (error) {
          console.error('Error loading bookings for date:', error);
          currentBookingsForDate = [];

          // ‡∏ã‡πà‡∏≠‡∏ô loading ‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
          hideRoomsLoading();
          renderRoomsList();
          updateStep2Button();
        })
        .getAllBookings(selectedDate);
    }

    function showRoomsLoading() {
      document.getElementById('rooms-loading').classList.remove('hidden');
      document.getElementById('rooms-list').classList.add('hidden');

      // Disable time buttons ‡πÅ‡∏•‡∏∞ next button ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÇ‡∏´‡∏•‡∏î
      document.getElementById('time-morning').disabled = true;
      document.getElementById('time-afternoon').disabled = true;
      document.getElementById('time-allday').disabled = true;
      document.getElementById('step2-next').disabled = true;
    }

    function hideRoomsLoading() {
      document.getElementById('rooms-loading').classList.add('hidden');
      document.getElementById('rooms-list').classList.remove('hidden');
      document.getElementById('rooms-list').classList.add('fade-in');

      // Enable time buttons
      document.getElementById('time-morning').disabled = false;
      document.getElementById('time-afternoon').disabled = false;
      document.getElementById('time-allday').disabled = false;
    }

    function renderRoomsList() {
      const container = document.getElementById('rooms-list');
      const filteredRooms = getFilteredRooms();

      if (filteredRooms.length === 0) {
        container.innerHTML = '<p class="text-gray-500 text-center py-4">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç</p>';
        return;
      }

      container.innerHTML = filteredRooms.map(room => `
        <div class="border rounded-lg p-4 fade-in">
          <h4 class="font-semibold text-gray-800 mb-3">${room.name}</h4>
          <div class="grid grid-cols-2 gap-2">
            ${room.computers.map(computer => {
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏à‡∏≠‡∏á‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
        const isBooked = checkIfBooked(room.id, computer.id);
        const bookingInfo = getBookingInfo(room.id, computer.id);

        return `
                <button onclick="selectRoomComputer('${room.id}', '${computer.id}')" 
                        id="room-${room.id}-${computer.id}"
                        class="p-3 border-2 rounded-lg text-left text-sm transition-all ${isBooked ? 'border-red-300 bg-red-50 opacity-60 cursor-not-allowed' : 'border-gray-200 hover:border-gray-300 hover:shadow-sm'}"
                        ${isBooked ? 'disabled' : ''}>
                  <p class="font-medium">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà ${computer.id}</p>
                  <p class="text-xs text-gray-600">${computer.os}</p>
                  <p class="text-xs text-gray-500">${computer.specs.join(', ')}</p>
                  ${bookingInfo ? `<p class="text-xs text-red-600 mt-1 font-medium">üîí ${bookingInfo}</p>` : '<p class="text-xs text-green-600 mt-1 font-medium">‚úì ‡∏ß‡πà‡∏≤‡∏á</p>'}
                </button>
              `;
      }).join('')}
          </div>
        </div>
      `).join('');
    }

    function checkIfBooked(roomId, computerId) {
      if (!selectedDate || !selectedTime) return false;

      return currentBookingsForDate.some(booking => {
        if (booking.room !== roomId || booking.computer !== computerId) {
          return false;
        }

        // ‡∏ñ‡πâ‡∏≤‡∏à‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏ß‡∏±‡∏ô = ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á
        if (booking.time === '‡∏ó‡∏±‡πâ‡∏á‡∏ß‡∏±‡∏ô' || selectedTime === '‡∏ó‡∏±‡πâ‡∏á‡∏ß‡∏±‡∏ô') {
          return true;
        }

        // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô = ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á
        if (booking.time === selectedTime) {
          return true;
        }

        return false;
      });
    }

    function getBookingInfo(roomId, computerId) {
      if (!selectedDate || !selectedTime) return null;

      const bookings = currentBookingsForDate.filter(b =>
        b.room === roomId && b.computer === computerId
      );

      if (bookings.length === 0) return null;

      const timeInfo = bookings.map(b => b.time).join(', ');
      return `‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß: ${timeInfo}`;
    }

    function getFilteredRooms() {
      if (!selectedOS && selectedUsage.length === 0) return allRooms;

      return allRooms.map(room => ({
        ...room,
        computers: room.computers.filter(computer => {
          const osMatch = !selectedOS || computer.os === selectedOS;
          const usageMatch = selectedUsage.length === 0 ||
            selectedUsage.every(usage => computer.specs.includes(usage));
          return osMatch && usageMatch;
        })
      })).filter(room => room.computers.length > 0);
    }

    function selectRoomComputer(roomId, computerId) {
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ñ‡∏π‡∏Å‡∏à‡∏≠‡∏á‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
      if (checkIfBooked(roomId, computerId)) {
        alert(currentLanguage === 'th' ?
          '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏à‡∏≠‡∏á‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å' :
          'This computer is already booked for the selected time');
        return;
      }

      selectedRoom = roomId;
      selectedComputer = computerId;

      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡∏õ‡∏¥‡∏î‡∏à‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
      if (isDateBlocked(selectedDate)) {
        const reason = getBlockedDateReason(selectedDate);
        alert((currentLanguage === 'th' ? '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£: ' : 'This computer is blocked: ') + reason);
        selectedRoom = '';
        selectedComputer = '';
        return;
      }

      // Reset all buttons
      document.querySelectorAll('[id^="room-"]').forEach(btn => {
        if (!btn.disabled) {
          btn.className = 'p-3 border-2 border-gray-200 rounded-lg hover:border-gray-300 text-left text-sm';
        }
      });

      // Highlight selected
      const selectedBtn = document.getElementById('room-' + roomId + '-' + computerId);
      if (selectedBtn && !selectedBtn.disabled) {
        selectedBtn.className = 'p-3 border-2 border-indigo-600 bg-indigo-50 rounded-lg text-left text-sm';
      }

      updateStep2Button();
    }

    function updateStep2Button() {
      const btn = document.getElementById('step2-next');
      if (selectedDate && selectedTime && selectedRoom && selectedComputer) {
        btn.disabled = false;
        btn.className = 'flex-1 bg-indigo-600 text-white py-3 rounded-lg hover:bg-indigo-700';
      } else {
        btn.disabled = true;
        btn.className = 'flex-1 bg-gray-300 text-white py-3 rounded-lg cursor-not-allowed';
      }
    }

    function goToStep(step) {
      // Hide all steps
      document.querySelectorAll('.booking-step').forEach(el => el.classList.add('hidden'));

      // Show selected step
      document.getElementById('step-' + step).classList.remove('hidden');

      // Update indicators
      for (let i = 1; i <= 3; i++) {
        const indicator = document.getElementById('step-' + i + '-indicator');
        if (i < step) {
          indicator.className = 'w-10 h-10 rounded-full flex items-center justify-center font-bold bg-indigo-600 text-white';
          if (i < 3) document.getElementById('step-' + i + '-line').className = 'w-24 h-1 bg-indigo-600';
        } else if (i === step) {
          indicator.className = 'w-10 h-10 rounded-full flex items-center justify-center font-bold bg-indigo-600 text-white';
        } else {
          indicator.className = 'w-10 h-10 rounded-full flex items-center justify-center font-bold bg-gray-200 text-gray-500';
          if (i < 3) document.getElementById('step-' + i + '-line').className = 'w-24 h-1 bg-gray-200';
        }
      }

      // Load profile data in step 3
      if (step === 3 && userProfile) {
        document.getElementById('form-firstname').value = userProfile.firstName || '';
        document.getElementById('form-lastname').value = userProfile.lastName || '';
        document.getElementById('form-phone').value = userProfile.phone || '';
        document.getElementById('form-studentid').value = userProfile.studentId || '';
      }
    }

    function submitBooking() {
      const consent = document.getElementById('form-consent').checked;
      if (!consent) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
        return;
      }

      const bookingData = {
        firstName: document.getElementById('form-firstname').value,
        lastName: document.getElementById('form-lastname').value,
        phone: document.getElementById('form-phone').value,
        studentId: document.getElementById('form-studentid').value,
        subject: document.getElementById('form-subject').value,
        reason: document.getElementById('form-reason').value,
        os: selectedOS,
        usage: selectedUsage,
        date: selectedDate,
        time: selectedTime,
        room: selectedRoom,
        computer: selectedComputer
      };

      // Validate
      if (!bookingData.firstName || !bookingData.lastName || !bookingData.phone ||
        !bookingData.studentId || !bookingData.subject || !bookingData.reason) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
        return;
      }

      // Show loading
      document.getElementById('step3-submit').disabled = true;
      document.getElementById('step3-submit').textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';

      google.script.run
        .withSuccessHandler(function (result) {
          if (result.success) {
            alert(result.message);
            resetBookingForm();
            loadUserBookings();
            showPage('history');
          } else {
            alert(result.error);
          }
          document.getElementById('step3-submit').disabled = false;
          document.getElementById('step3-submit').textContent = '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á';
        })
        .withFailureHandler(function (error) {
          alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
          document.getElementById('step3-submit').disabled = false;
          document.getElementById('step3-submit').textContent = '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á';
        })
        .createBooking(bookingData);
    }

    function resetBookingForm() {
      selectedOS = '';
      selectedUsage = [];
      selectedDate = '';
      selectedTime = '';
      selectedRoom = '';
      selectedComputer = '';

      goToStep(1);

      // Reset OS buttons
      document.getElementById('os-mac').className = 'p-4 border-2 border-gray-200 rounded-lg hover:border-gray-300';
      document.getElementById('os-windows').className = 'p-4 border-2 border-gray-200 rounded-lg hover:border-gray-300';

      // Reset usage buttons
      usageOptions.forEach(usage => {
        const btn = document.getElementById('usage-' + usage.replace(/\s/g, '-'));
        if (btn) btn.className = 'p-3 border-2 border-gray-200 rounded-lg hover:border-gray-300 text-sm';
      });

      // Reset time buttons
      document.getElementById('time-morning').className = 'p-3 border-2 border-gray-200 rounded-lg';
      document.getElementById('time-afternoon').className = 'p-3 border-2 border-gray-200 rounded-lg';
      document.getElementById('time-allday').className = 'p-3 border-2 border-gray-200 rounded-lg';

      // Clear form inputs
      document.getElementById('booking-date').value = '';
      document.getElementById('form-firstname').value = '';
      document.getElementById('form-lastname').value = '';
      document.getElementById('form-phone').value = '';
      document.getElementById('form-studentid').value = '';
      document.getElementById('form-subject').value = '';
      document.getElementById('form-reason').value = '';
      document.getElementById('form-consent').checked = false;

      updateStep1Button();
    }

    // History functions
    function filterBookings(filterType) {
      currentFilter = filterType;

      // Update filter buttons
      document.getElementById('filter-all').className = 'px-4 py-2 rounded-lg text-sm bg-white text-gray-700 border';
      document.getElementById('filter-upcoming').className = 'px-4 py-2 rounded-lg text-sm bg-white text-gray-700 border';
      document.getElementById('filter-byDate').className = 'px-4 py-2 rounded-lg text-sm bg-white text-gray-700 border';
      document.getElementById('filter-' + filterType).className = 'px-4 py-2 rounded-lg text-sm bg-indigo-600 text-white';

      renderBookings();
    }

    function renderBookings() {
      const container = document.getElementById('bookings-list');
      let filteredBookings = [...allBookings];

      console.log('Rendering bookings:', filteredBookings);
      console.log('Current filter:', currentFilter);

      if (currentFilter === 'upcoming') {
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        filteredBookings = filteredBookings.filter(b => {
          const bookingDate = new Date(b.date);
          return bookingDate >= today;
        });
      } else if (currentFilter === 'byDate') {
        filteredBookings.sort((a, b) => new Date(a.date) - new Date(b.date));
      }

      if (filteredBookings.length === 0) {
        container.innerHTML = `
          <div class="bg-white rounded-lg shadow p-8 text-center">
            <p class="text-gray-500" data-th="‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á" data-en="No booking history">${currentLanguage === 'th' ? '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á' : 'No booking history'}</p>
          </div>
        `;
        return;
      }

      const labels = {
        confirmed: currentLanguage === 'th' ? '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß' : 'Confirmed',
        date: currentLanguage === 'th' ? '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà' : 'Date',
        time: currentLanguage === 'th' ? '‡πÄ‡∏ß‡∏•‡∏≤' : 'Time',
        subject: currentLanguage === 'th' ? '‡∏ß‡∏¥‡∏ä‡∏≤' : 'Subject',
        reason: currentLanguage === 'th' ? '‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•' : 'Reason',
        cancel: currentLanguage === 'th' ? '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á' : 'Cancel Booking',
        bookingId: currentLanguage === 'th' ? '‡∏£‡∏´‡∏±‡∏™‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á' : 'Booking ID'
      };

      container.innerHTML = filteredBookings.map(booking => {
        console.log('Rendering booking:', booking);
        const isPast = new Date(booking.date) < new Date();

        return `
          <div class="bg-white rounded-lg shadow p-4 md:p-6 hover:shadow-md transition">
            <div class="flex flex-col md:flex-row justify-between items-start mb-4 gap-3">
              <div class="flex-1">
                <h3 class="text-lg font-semibold text-gray-800">${booking.room || 'N/A'} - ${currentLanguage === 'th' ? '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà' : 'Computer'} ${booking.computer || 'N/A'}</h3>
                <p class="text-gray-600 text-sm">${booking.os || 'N/A'} | ${(booking.usage || []).join(', ')}</p>
                <p class="text-xs text-gray-500 mt-1">${labels.bookingId}: ${booking.id}</p>
              </div>
              <div class="flex flex-col md:flex-row gap-2 w-full md:w-auto">
                <span class="px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800 text-center">
                  ${labels.confirmed}
                </span>
                ${!isPast ? `
                  <button onclick="cancelBooking('${booking.id}')" class="px-3 py-1 rounded-lg text-sm font-medium bg-red-100 text-red-700 hover:bg-red-200 transition">
                    ${labels.cancel}
                  </button>
                ` : ''}
              </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
              <div>
                <p class="text-gray-500">${labels.date}</p>
                <p class="text-gray-800 font-medium">${formatDate(booking.date)}</p>
              </div>
              <div>
                <p class="text-gray-500">${labels.time}</p>
                <p class="text-gray-800 font-medium">${booking.time || 'N/A'}</p>
              </div>
              <div>
                <p class="text-gray-500">${labels.subject}</p>
                <p class="text-gray-800 font-medium">${booking.subject || 'N/A'}</p>
              </div>
              <div>
                <p class="text-gray-500">${labels.reason}</p>
                <p class="text-gray-800 font-medium">${booking.reason || 'N/A'}</p>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    function cancelBooking(bookingId) {
      const confirmMsg = currentLanguage === 'th' ?
        '‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?' :
        'Do you want to cancel this booking?';

      if (!confirm(confirmMsg)) return;

      google.script.run
        .withSuccessHandler(function (result) {
          if (result.success) {
            alert(result.message);
            loadUserBookings();
          } else {
            alert(result.error);
          }
        })
        .withFailureHandler(function (error) {
          alert((currentLanguage === 'th' ? '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' : 'Error: ') + error.message);
        })
        .cancelBooking(bookingId);
    }

    function formatDate(dateStr) {
      try {
        if (!dateStr) return 'N/A';
        const date = new Date(dateStr);
        if (isNaN(date.getTime())) return dateStr; // ‡∏ñ‡πâ‡∏≤‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        return date.toLocaleDateString('th-TH', options);
      } catch (e) {
        console.error('Error formatting date:', e);
        return dateStr;
      }
    }

    // Schedule functions
    function loadSchedule() {
      const selectedDate = document.getElementById('schedule-date').value;

      if (!selectedDate) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà');
        return;
      }

      // ‡πÅ‡∏™‡∏î‡∏á loading
      document.getElementById('schedule-loading').classList.remove('hidden');
      document.getElementById('schedule-container').classList.add('hidden');
      document.getElementById('schedule-stats').innerHTML = '';

      google.script.run
        .withSuccessHandler(function (bookings) {
          console.log('Schedule bookings:', bookings);
          renderSchedule(bookings, selectedDate);

          // ‡∏ã‡πà‡∏≠‡∏ô loading
          document.getElementById('schedule-loading').classList.add('hidden');
          document.getElementById('schedule-container').classList.remove('hidden');
          document.getElementById('schedule-container').classList.add('fade-in');
        })
        .withFailureHandler(function (error) {
          console.error('Error loading schedule:', error);
          alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á');

          // ‡∏ã‡πà‡∏≠‡∏ô loading
          document.getElementById('schedule-loading').classList.add('hidden');
          document.getElementById('schedule-container').classList.remove('hidden');
        })
        .getAllBookings(selectedDate);
    }

    function loadScheduleBlockedDates() {
      google.script.run
        .withSuccessHandler(function (dates) {
          blockedDates = dates;
        })
        .getBlockedDates();
    }

    function renderSchedule(bookings, selectedDate) {
      const tbody = document.getElementById('schedule-tbody');

      console.log('‚úÖ Loading schedule Block for date:', blockedDates);

      if (allRooms.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" class="px-6 py-4 text-center text-gray-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>';
        return;
      }

      const rows = [];
      let totalSlots = 0;
      let bookedSlots = 0;
      let myBookings = 0;

      allRooms.forEach(room => {
        room.computers.forEach(computer => {
          totalSlots += 2; // ‡πÄ‡∏ä‡πâ‡∏≤ + ‡∏ö‡πà‡∏≤‡∏¢
          const blocked = [...blockedDates].find(b =>
            b.date === selectedDate &&
            b.computer === computer.id &&
            b.room === room.id
          );
          const isBlocked = !!blocked;
          const blockedReason = currentLanguage === 'th' ? (blocked ? blocked.reason : '') : (blocked ? blocked.reasonEN : '');

          // Check if booked
          const morningBooking = bookings.find(b =>
            b.room === room.id && b.computer === computer.id &&
            (b.time === '‡πÄ‡∏ä‡πâ‡∏≤' || b.time === '‡∏ó‡∏±‡πâ‡∏á‡∏ß‡∏±‡∏ô')
          );

          const afternoonBooking = bookings.find(b =>
            b.room === room.id && b.computer === computer.id &&
            (b.time === '‡∏ö‡πà‡∏≤‡∏¢' || b.time === '‡∏ó‡∏±‡πâ‡∏á‡∏ß‡∏±‡∏ô')
          );

          if (morningBooking) {
            bookedSlots++;
            if (morningBooking.email === currentUser?.email) myBookings++;
          }
          if (afternoonBooking) {
            bookedSlots++;
            if (afternoonBooking.email === currentUser?.email) myBookings++;
          }

          const morningIsMyBooking = morningBooking && morningBooking.email === currentUser?.email;
          const afternoonIsMyBooking = afternoonBooking && afternoonBooking.email === currentUser?.email;

          isBlocked
            ? rows.push(`
              <tr class="hover:bg-gray-50 transition">
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${room.name}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${computer.id}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                  <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-gray-100 text-gray-800">
                    ${computer.os}
                  </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-center">
                  <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-red-100 text-red-800">
                    ${blockedReason}
                  </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-center">
                  <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-red-100 text-red-800">
                    ${blockedReason}
                  </span>
                </td>
              </tr>
            `)
            : rows.push(`
              <tr class="hover:bg-gray-50 transition">
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${room.name}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${computer.id}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                  <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-gray-100 text-gray-800">
                    ${computer.os}
                  </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-center">
                  ${morningBooking ? `
                    <div class="inline-flex flex-col items-center">
                      <span class="px-3 py-1 text-xs rounded-full font-medium ${morningIsMyBooking ? 'bg-yellow-100 text-yellow-800 border border-yellow-300' : 'bg-red-100 text-red-800 border border-red-300'}">
                        ${morningIsMyBooking ? 'üîë ‡∏à‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì' : 'üîí ‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß'}
                      </span>
                      <span class="text-xs text-gray-500 mt-1">${morningBooking.firstName} ${morningBooking.lastName}</span>
                    </div>
                  ` : `
                    <span class="px-3 py-1 text-xs rounded-full font-medium bg-green-100 text-green-800 border border-green-300">
                      ‚úì ‡∏ß‡πà‡∏≤‡∏á
                    </span>
                  `}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-center">
                  ${afternoonBooking ? `
                    <div class="inline-flex flex-col items-center">
                      <span class="px-3 py-1 text-xs rounded-full font-medium ${afternoonIsMyBooking ? 'bg-yellow-100 text-yellow-800 border border-yellow-300' : 'bg-red-100 text-red-800 border border-red-300'}">
                        ${afternoonIsMyBooking ? 'üîë ‡∏à‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì' : 'üîí ‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß'}
                      </span>
                      <span class="text-xs text-gray-500 mt-1">${afternoonBooking.firstName} ${afternoonBooking.lastName}</span>
                    </div>
                  ` : `
                    <span class="px-3 py-1 text-xs rounded-full font-medium bg-green-100 text-green-800 border border-green-300">
                      ‚úì ‡∏ß‡πà‡∏≤‡∏á
                    </span>
                  `}
                </td>
              </tr>
            `);
        });
      });

      tbody.innerHTML = rows.join('');

      // Render stats
      renderScheduleStats(totalSlots, bookedSlots, myBookings, selectedDate);
    }

    function renderScheduleStats(total, booked, mine, date) {
      const available = total - booked;
      const bookedPercent = Math.round((booked / total) * 100);
      const availablePercent = Math.round((available / total) * 100);

      document.getElementById('schedule-stats').innerHTML = `
        <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-4 border border-blue-200">
          <div class="flex items-center justify-between mb-2">
            <span class="text-sm font-medium text-blue-900">‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
            <span class="text-2xl font-bold text-blue-700">${total}</span>
          </div>
          <p class="text-xs text-blue-600">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${formatDate(date)}</p>
        </div>
        
        <div class="bg-gradient-to-br from-red-50 to-red-100 rounded-lg p-4 border border-red-200">
          <div class="flex items-center justify-between mb-2">
            <span class="text-sm font-medium text-red-900">‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß</span>
            <span class="text-2xl font-bold text-red-700">${booked}</span>
          </div>
          <div class="flex items-center gap-2">
            <div class="flex-1 bg-red-200 rounded-full h-2">
              <div class="bg-red-600 h-2 rounded-full transition-all" style="width: ${bookedPercent}%"></div>
            </div>
            <span class="text-xs font-medium text-red-700">${bookedPercent}%</span>
          </div>
        </div>
        
        <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-4 border border-green-200">
          <div class="flex items-center justify-between mb-2">
            <span class="text-sm font-medium text-green-900">‡∏ß‡πà‡∏≤‡∏á</span>
            <span class="text-2xl font-bold text-green-700">${available}</span>
          </div>
          <div class="flex items-center gap-2">
            <div class="flex-1 bg-green-200 rounded-full h-2">
              <div class="bg-green-600 h-2 rounded-full transition-all" style="width: ${availablePercent}%"></div>
            </div>
            <span class="text-xs font-medium text-green-700">${availablePercent}%</span>
          </div>
        </div>
        
        ${mine > 0 ? `
          <div class="col-span-3 bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-lg p-4 border border-yellow-200">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-2">
                <span class="text-2xl">üîë</span>
                <span class="text-sm font-medium text-yellow-900">‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</span>
              </div>
              <span class="text-2xl font-bold text-yellow-700">${mine}</span>
            </div>
          </div>
        ` : ''}
      `;
    }

    // Profile functions
    function saveProfile() {
      const profile = {
        firstName: document.getElementById('profile-firstname').value,
        lastName: document.getElementById('profile-lastname').value,
        phone: document.getElementById('profile-phone').value,
        studentId: document.getElementById('profile-studentid').value,
        language: document.getElementById('profile-language').value
      };

      if (!profile.firstName || !profile.lastName || !profile.phone || !profile.studentId) {
        alert(currentLanguage === 'th' ? '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô' : 'Please fill in all fields');
        return;
      }

      google.script.run
        .withSuccessHandler(function (result) {
          if (result.success) {
            alert(currentLanguage === 'th' ? '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à' : 'Profile saved successfully');
            userProfile = profile;
            currentLanguage = profile.language;
            document.getElementById('header-language').value = currentLanguage;
            updateLanguage();
          }
        })
        .withFailureHandler(function (error) {
          alert((currentLanguage === 'th' ? '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' : 'Error: ') + error.message);
        })
        .saveUserProfile(profile);
    }

    // Blocked Dates functions
    function formatDateToLocal(dateString) {
      if (!dateString) return '';
      const date = new Date(dateString);
      // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô YYYY-MM-DD ‡∏ï‡∏≤‡∏° timezone ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
      return date.toISOString().slice(0, 10);
    }

    // Config functions
    function loadConfig() {
      google.script.run
        .withSuccessHandler(function (configStr) {
          let config;
          try {
            config = JSON.parse(configStr);
            systemConfig = config;
            systemConfig.bookingStartDate = formatDateToLocal(systemConfig.bookingStartDate);
            systemConfig.bookingEndDate = formatDateToLocal(systemConfig.bookingEndDate);
          } catch (e) {
            console.error('Error parsing config JSON:', e, configStr);
            return;
          }

          console.log('‚úÖ Config from server:', config);

          document.getElementById('config-start-date').value = systemConfig.bookingStartDate;
          document.getElementById('config-end-date').value = systemConfig.bookingEndDate;
          document.getElementById('config-email-enabled').checked =
            config.emailEnabled === 'true' || config.emailEnabled === true;
          document.getElementById('config-admin-email').value = config.adminEmail || '';
        })
        .withFailureHandler(function (err) {
          console.error('‚ùå Error loading config:', err);
          alert('Error loading config: ' + err.message);
        })
        .getConfig();
    }

    function saveConfig() {
      const config = {
        bookingStartDate: document.getElementById('config-start-date').value,
        bookingEndDate: document.getElementById('config-end-date').value,
        emailEnabled: document.getElementById('config-email-enabled').checked ? 'true' : 'false',
        adminEmail: document.getElementById('config-admin-email').value
      };

      google.script.run
        .withSuccessHandler(function (result) {
          if (result.success) {
            alert(currentLanguage === 'th' ? '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à' : 'Settings saved successfully');
            systemConfig = config;
          }
        })
        .withFailureHandler(function (error) {
          alert((currentLanguage === 'th' ? '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' : 'Error: ') + error.message);
        })
        .saveConfig(config);
    }

    function loadBlockedDates() {
      google.script.run
        .withSuccessHandler(function (dates) {
          blockedDates = dates;
          renderBlockedDates();
        })
        .getBlockedDates();
    }

    function renderBlockedDates() {
      const container = document.getElementById('blocked-dates-list');

      if (blockedDates.length === 0) {
        container.innerHTML = `<p class="text-gray-500 text-center py-4">${currentLanguage === 'th' ? '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á' : 'No blocked dates'}</p>`;
        return;
      }

      // Group by date
      const groupedByDate = {};
      blockedDates.forEach(item => {
        if (!groupedByDate[item.date]) {
          groupedByDate[item.date] = [];
        }
        groupedByDate[item.date].push(item);
      });

      container.innerHTML = Object.keys(groupedByDate).map(date => `
        <div class="bg-gray-50 rounded-lg border p-4">
          <h4 class="font-semibold text-gray-800 mb-3">${formatDate(date)}</h4>
          <div class="space-y-2">
            ${groupedByDate[date].map(item => `
              <div class="flex flex-col md:flex-row items-start md:items-center justify-between p-3 bg-white rounded border gap-2">
                <div class="flex-1">
                  <p class="font-medium text-gray-800">${item.room ? item.room + ' - ' + item.computer : (currentLanguage === 'th' ? '‡∏ó‡∏∏‡∏Å‡∏´‡πâ‡∏≠‡∏á' : 'All Rooms')}</p>
                  <p class="text-sm text-gray-600">${currentLanguage === 'th' ? item.reason : item.reasonEN}</p>
                </div>
                <button onclick="removeBlockedDate('${item.date}', '${item.room}', '${item.computer}')" class="px-3 py-1 bg-red-100 text-red-700 rounded hover:bg-red-200 text-sm whitespace-nowrap">
                  ${currentLanguage === 'th' ? '‡∏•‡∏ö' : 'Remove'}
                </button>
              </div>
            `).join('')}
          </div>
        </div>
      `).join('');
    }

    function addBlockedDate() {
      const date = document.getElementById('blocked-date').value;
      const room = document.getElementById('blocked-room').value;
      const computer = document.getElementById('blocked-computer').value;
      const reasonTH = document.getElementById('blocked-reason-th').value;
      const reasonEN = document.getElementById('blocked-reason-en').value;

      if (!date || !reasonTH || !reasonEN) {
        alert(currentLanguage === 'th' ? '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• (‡∏ó‡∏±‡πâ‡∏á 2 ‡∏†‡∏≤‡∏©‡∏≤)' : 'Please fill in date and reason (both languages)');
        return;
      }

      if (room && !computer) {
        alert(currentLanguage === 'th' ? '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á' : 'Please select computer');
        return;
      }

      google.script.run
        .withSuccessHandler(function (result) {
          if (result.success) {
            document.getElementById('blocked-date').value = '';
            document.getElementById('blocked-room').value = '';
            document.getElementById('blocked-computer').value = '';
            document.getElementById('blocked-reason-th').value = '';
            document.getElementById('blocked-reason-en').value = '';
            updateBlockedComputers();
            loadBlockedDates();
          }
        })
        .addBlockedDate(date, room, computer, reasonTH, reasonEN);
    }

    function removeBlockedDate(date, room, computer) {
      if (!confirm(currentLanguage === 'th' ? '‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ?' : 'Remove this date?')) {
        return;
      }

      google.script.run
        .withSuccessHandler(function (result) {
          if (result.success) {
            loadBlockedDates();
          }
        })
        .removeBlockedDate(date, room, computer);
    }

    function isDateBlocked(dateStr) {
      return blockedDates.some(item =>
        item.date === dateStr &&
        (!item.room || (item.room === selectedRoom && item.computer === selectedComputer))
      );
    }

    function getBlockedDateReason(dateStr) {
      const item = blockedDates.find(item =>
        item.date === dateStr &&
        (!item.room || (item.room === selectedRoom && item.computer === selectedComputer))
      );
      if (!item) return null;
      return currentLanguage === 'th' ? item.reason : item.reasonEN;
    }

  </script>
</body>

</html>